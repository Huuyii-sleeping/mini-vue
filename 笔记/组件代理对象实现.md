# 实现组件代理对象

创建代理对象，使得能够拿到对应的setup中的数据
和其他之类的数据

增强组件的行为

实现响应式数据

简化操作状态



1. 创建proxy代理对象

   ```ts
   instance.proxy = new Proxy({ _: instance }, PubilcInstanceProxyHandlers)
   
   const pubilcPropertyMap = {
       $el : (i) => i.vnode.el,
   }
   export const PubilcInstanceProxyHandlers = {
       get({ _: instance }, key) {
           // setupState
           const { setupState } = instance
           if (key in setupState) {
               return setupState[key]
           }
   
           // key -> $el
           const pubilcGetter = pubilcPropertyMap[key]
           if(pubilcGetter){
               return pubilcGetter(instance)
           }
       }
   }
   ```

   

2. 在render函数中指定特定的this

   ```ts
   function setupRenderEffect(instance, initialVnode ,container) {
       const { proxy } = instance
       // 进行this的绑定
       const subTree = instance.render.call(proxy)
       // vnode tree
       // vnode -> patch
       // component -> vnode : element -> mountElement
       patch(subTree, container)
       // 获取处理之后的结果
       initialVnode.el = subTree.el   
   }
   ```

   

3. 使用$el的时候，能够先存储到vnode当中
   注意这个要等待处理完毕之后才能挂载到proxy当中

   ```ts
   function setupRenderEffect(instance, initialVnode ,container) {
       const { proxy } = instance
       const subTree = instance.render.call(proxy)
       // vnode tree
       // vnode -> patch
       // component -> vnode : element -> mountElement
       patch(subTree, container)
       // 获取处理之后的结果
       initialVnode.el = subTree.el   
   }
   ```

   